<style>
  :root {
      /* --- PALETTE DEFINITIONS --- */
      
      /* Core Colors */
      --rmu-cse-primary: #333;           /* Main text, Section Headers, Heavy borders */
      --rmu-cse-secondary: #666;         /* Labels, Left-borders on categories */
      --rmu-cse-tertiary: #888;          /* Footer text */
      --rmu-cse-alert: #c00;             /* Fumbles / Warnings */
      
      /* Text Colors */
      --rmu-cse-text-main: #333;
      --rmu-cse-text-light: #555;        /* Subtitles, Metadata */
      --rmu-cse-text-inverse: #fff;      /* Text on dark backgrounds */
      
      /* Backgrounds */
      --rmu-cse-bg-sheet: #f4f4f4;       /* Main page background */
      --rmu-cse-bg-card: #fff;           /* White containers (Stat boxes, Armor) */
      --rmu-cse-bg-panel: #fafafa;       /* Light gray panels (Quick Info, Inventory) */
      --rmu-cse-bg-header: #e8e8e8;      /* Category/Group headers */
      --rmu-cse-bg-table-head: #eee;     /* Table headers */
      
      /* Borders */
      --rmu-cse-border-heavy: #333;
      --rmu-cse-border-main: #ccc;       /* Standard separators */
      --rmu-cse-border-light: #ddd;      /* Subtle borders (Stat boxes) */
      --rmu-cse-border-subtle: #eee;     /* Very light dividers */
      --rmu-cse-border-dashed: #999;     /* Dashed outlines */
  }

  /* SHEET STYLES */
  
  .rmu-sheet { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      max-width: 800px; 
      color: var(--rmu-cse-text-main); 
      line-height: 1.4; 
      font-size: 14px; 
      background-color: var(--rmu-cse-bg-sheet); 
      padding: 10px;
  }
  
  /* General Styles */
  .section-title { 
      background: var(--rmu-cse-primary); 
      color: var(--rmu-cse-text-inverse); 
      padding: 4px 8px; 
      font-weight: bold; 
      margin-top: 20px; 
      margin-bottom: 8px; 
      border-radius: 3px; 
      font-size: 1.1em; 
  }
  
  .list-container { columns: 3; column-gap: 20px; }
  .block { break-inside: avoid; margin-bottom: 12px; }
  
  .header { 
      font-weight: bold; 
      text-transform: uppercase; 
      font-size: 0.85em; 
      background: var(--rmu-cse-bg-header); 
      padding: 2px 5px; 
      border-left: 3px solid var(--rmu-cse-secondary); 
      margin-bottom: 4px; 
  }
  
  .row { 
      display: flex; 
      justify-content: space-between; 
      border-bottom: 1px dotted var(--rmu-cse-border-main); 
      padding: 1px 0; 
      font-size: 0.95em; 
  }
  
  .footer {
      margin-top: 40px; 
      padding-top: 10px; 
      border-top: 1px solid var(--rmu-cse-border-main); 
      font-size: 0.7em; 
      color: var(--rmu-cse-tertiary); 
      display: flex; 
      justify-content: space-between; 
  }
  
  .text-center { text-align: center; }

  /* Header & Quick Info */
  .header-block { 
      border-bottom: 2px solid var(--rmu-cse-border-heavy); 
      padding-bottom: 5px; 
      margin-bottom: 10px; 
  }
  
  .header-title { font-size: 24px; font-weight: bold; text-transform: uppercase; margin: 0; }
  .header-sub { font-style: italic; color: var(--rmu-cse-text-light); font-size: 1.1em; }
  
  .quick-info-grid { 
      display: flex; 
      justify-content: space-between; 
      background: var(--rmu-cse-bg-panel); 
      padding: 8px; 
      border-radius: 4px; 
      margin-bottom: 15px; 
      font-weight: bold; 
      border: 1px solid var(--rmu-cse-border-light); 
  }
  
  /* Stats & Res Grid */
  .stat-grid { 
      display: grid; 
      grid-template-columns: repeat(10, 1fr); 
      gap: 5px; 
      margin-bottom: 10px; 
  }
  
  .stat-box { 
      border: 1px solid var(--rmu-cse-border-light); 
      padding: 4px; 
      text-align: center; 
      background: var(--rmu-cse-bg-card); 
  }
  
  .stat-label { 
      font-weight: bold; 
      font-size: 11px; 
      display: block; 
      color: var(--rmu-cse-secondary); 
      text-transform: uppercase; 
  }
  .stat-value { font-size: 16px; font-weight: bold; }
  
  .res-grid { 
      display: flex; 
      justify-content: space-between; 
      border-top: 1px solid var(--rmu-cse-border-main); 
      border-bottom: 1px solid var(--rmu-cse-border-main); 
      padding: 5px 0; 
      margin-bottom: 15px; 
      background-color: var(--rmu-cse-bg-panel); 
  }
  
  .res-item { text-align: center; flex: 1; border-right: 1px solid var(--rmu-cse-border-subtle); }
  .res-item:last-child { border-right: none; }
  
  /* Defense Section */
  .defense-container { display: flex; gap: 20px; margin-bottom: 15px; }
  .defense-left { flex: 1; }
  .defense-right { flex: 1; }

  /* Tactical Table */
  .tactical-table { width: 100%; border-collapse: collapse; font-size: 0.9em; text-align: center; }
  .tactical-table th { 
      background: var(--rmu-cse-bg-table-head); 
      padding: 4px; 
      border: 1px solid var(--rmu-cse-border-main); 
  }
  .tactical-table td { 
      border: 1px solid var(--rmu-cse-border-main); 
      padding: 4px; 
  }

  /* Armor Grid */
  .armor-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px; margin-top: 5px; }
  .armor-box { 
      border: 1px dashed var(--rmu-cse-border-dashed); 
      padding: 5px; 
      font-size: 0.85em; 
      background: var(--rmu-cse-bg-card); 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
  }
  .armor-loc { 
      font-weight: bold; 
      text-transform: uppercase; 
      font-size: 0.8em; 
      color: var(--rmu-cse-secondary); 
      margin-right: 5px; 
  }

  /* Attack Table */
  .attack-table { text-align: left; width: 100%; border-collapse: collapse; margin-bottom: 15px; }
  .attack-table th.text-center, .attack-table td.text-center { text-align: center; }
  
  .attack-table th { 
      text-align: left; 
      border-bottom: 2px solid var(--rmu-cse-border-heavy); 
      font-size: 0.9em; 
      padding: 4px; 
      background-color: var(--rmu-cse-bg-table-head); 
  }
  
  .attack-table td { 
      border-bottom: 1px solid var(--rmu-cse-border-subtle); 
      padding: 6px 4px; 
  }
  .attack-ob { font-weight: bold; font-size: 1.1em; }

  /* Talents */
  .talent-item { 
      display: flex; 
      justify-content: space-between; 
      border-bottom: 1px dotted var(--rmu-cse-border-main); 
      padding: 1px 0; 
      font-size: 0.95em; 
  }

  /* Inventory */
  .inv-stats { 
      display: flex; 
      justify-content: space-between; 
      background: var(--rmu-cse-bg-panel); 
      padding: 0.5rem 1rem; 
      border-bottom: 1px solid var(--rmu-cse-border-main); 
      font-size: 0.9em; 
      margin-bottom: 5px; 
  }
  
  .inv-row { break-inside: avoid; align-items: center; }
  
  .inv-meta { 
      display: flex; 
      justify-content: flex-end; 
      min-width: 110px; 
      font-size: 0.85em; 
      color: var(--rmu-cse-text-light); 
  }
  
  .inv-qty { 
      width: 35px; 
      text-align: center; 
      border-right: 1px solid var(--rmu-cse-border-light); 
      margin-right: 5px; 
  }
  .inv-wgt { width: 60px; text-align: right; }

  /* Skills Groups */
  .skill-bonus { font-weight: bold; }

  /* Spell Lists*/
  .spell-list-type { font-size:0.8em; font-weight:normal; color: var(--rmu-cse-secondary); }
  .spell-row { display: flex; font-size: 0.95em; }

  /* PRINT SPECIFIC STYLES */
  @media print {
      body { margin: 0; padding: 0; }
      .rmu-sheet { max-width: 100%; border: none; }
      
      /* Avoid breaking elements */
      .section-title, .header-block, .quick-info-grid, .stat-grid, .res-grid, .block {
          break-inside: avoid;
      }
      
      /* Force background colors */
      .section-title, .header, .attack-table th, .quick-info-grid, .inv-stats, .stat-box {
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
      }
  }
</style>

<div class="rmu-sheet">
    <div class="header-block">
        <div class="header-title">{{header.name}}</div>
        <div class="header-sub">
            Level {{header.level}} • {{header.culture}} • {{header.race}} • {{header.profession}} • {{header.realm}} • {{header.size}}
        </div>
    </div>

    <div class="quick-info-grid">
        <span>BMR: {{quick_info.bmr_value}} ({{quick_info.bmr_mode}})</span>
        <span>Initiative: {{quick_info.initiative}}</span>
        <span>HP: {{quick_info.hits.current}} / {{quick_info.hits.max}}</span>
        <span>Physical End: {{quick_info.endurance_physical}}</span>
        <span>Mental End: {{quick_info.endurance_mental}}</span>
        <span>Power: {{quick_info.power.current}} / {{quick_info.power.max}}</span>
    </div>

    <div class="stat-grid">
        {{#each stats}}
        <div class="stat-box">
            <span class="stat-label">{{label}}</span>
            <span class="stat-value">{{bonus}}</span>
        </div>
        {{/each}}
    </div>

    <div class="res-grid">
        {{#each resistances}}
        <div class="res-item">
            <div class="stat-label">{{label}}</div>
            <strong>+{{bonus}}</strong>
        </div>
        {{/each}}
    </div>

    <div class="section-title">Defenses & Armor</div>
    <div class="defense-container">
        
        <div class="defense-left">
            <div class="header">Total DB</div>
            <table class="tactical-table">
                <tr>
                    <th></th>
                    <th>Dodge DB</th>
                    <th>Block DB</th>
                </tr>
                {{#each defenses.tactical}}
                <tr>
                    <td>{{mode}}</td>
                    <td>{{dodge}}</td>
                    <td>{{block}}</td>
                </tr>
                {{/each}}
            </table>
        </div>

        <div class="defense-right">
            <div class="header">Armor Coverage</div>
            <div class="armor-grid">
                <div class="armor-box"><span class="armor-loc">Head</span> {{defenses.armor.head.name}} (AT{{defenses.armor.head.at}})</div>
                <div class="armor-box"><span class="armor-loc">Torso</span> {{defenses.armor.torso.name}} (AT{{defenses.armor.torso.at}})</div>
                <div class="armor-box"><span class="armor-loc">Arms</span> {{defenses.armor.arms.name}} (AT{{defenses.armor.arms.at}})</div>
                <div class="armor-box"><span class="armor-loc">Legs</span> {{defenses.armor.legs.name}} (AT{{defenses.armor.legs.at}})</div>
            </div>
        </div>
    </div>

    <div class="section-title">Attacks</div>
    <table class="attack-table">
        <thead>
            <tr>
                <th width="30%">Weapon</th>
                <th width="10%" class="text-center">OB</th>
                <th width="10%" class="text-center">Fumble</th>
                <th width="20%">Chart</th>
                <th width="15%" class="text-center">Reach</th>
                <th width="15%" class="text-center">Range</th>
            </tr>
        </thead>
        <tbody>
            {{#each attacks}}
            <tr>
                <td>{{name}} ({{specialization}} {{handed}})</td>
                <td class="attack-ob text-center">{{ob}}</td>
                <td class="text-center" style="color: var(--rmu-cse-alert);">{{fumble}}</td>
                <td>{{damageType}}</td>
                <td class="text-center">{{reach}}</td>
                <td class="text-center">{{range}}</td>
            </tr>
            {{/each}}
        </tbody>
    </table>

    <div class="section-title">Skills</div>
    <div class="list-container">
        {{#each skill_groups}}
        <div class="block">
            <div class="header">{{category}}</div>
            {{#each list}}
            <div class="row">
                <span>{{name}}{{#if specialisation}}: {{specialisation}}{{/if}}</span>
                <span class="skill-bonus">{{bonus}} ({{ranks}})</span>
            </div>
            {{/each}}
        </div>
        {{/each}}
    </div>

    {{#if spells}}
    <div class="section-title">Spell Lists</div>
    <div class="list-container">
        {{#each spells}}
        <div class="block">
            <div class="header">{{listName}} <span class="spell-list-type">({{type}})</span></div>
            {{#each spells}}
            <div class="spell-row">
                <span>{{level}}. {{name}}</span>
            </div>
            {{/each}}
        </div>
        {{/each}}
    </div>
    {{/if}}

    <div class="section-title">Inventory</div>
    <div class="inv-stats">
        <span><strong>Allowance:</strong> {{inventory.weight_allowance}}</span>
        <span><strong>Carried:</strong> {{inventory.weight_carried}}</span>
        <span><strong>Enc. Penalty:</strong> {{inventory.enc_penalty}}</span>
        <span><strong>Max Pace:</strong> {{inventory.max_pace}}</span>
    </div>
    <div class="list-container">
        {{#each inventory.items}}
        <div class="row inv-row">
            <span>{{name}}</span>            
            <div class="inv-meta">
                <span class="inv-qty" title="Quantity">x{{qty}}</span>
                <span class="inv-wgt" title="Weight">{{weight}}</span>
            </div>
        </div>
        {{/each}}
    </div>

    <div class="section-title">Talents</div>
    <div class="list-container">
        {{#each talents}}
        <div class="block">
            <div class="header">{{group}}</div>
            {{#each entries}}
            <div class="row">
                <span class="talent-item">• {{name}} {{tier}}</span>
            </div>
            {{/each}}
        </div>
        {{/each}}
    </div>

    <div class="footer">
        <span>Generated: {{meta.timestamp}}</span>
        <span>RMU System v{{meta.systemVersion}}</span>
        <span>Exporter v{{meta.moduleVersion}}</span>
    </div>
</div>